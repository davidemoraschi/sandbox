CREATE OR REPLACE FUNCTION MSTR_SIGLO.FUNC_RECUPERA_CATALOGO (p_GCDIRECTA IN VARCHAR2)
   RETURN NUMBER
IS
   v_ARTICULO   REP_PRO_SIGLO.CAT_ARTICULOCLASIF.ARTICULO@SYG%TYPE;
   n_COUNTER    NUMBER := 0;
   n_COUNT      NUMBER := 0;
BEGIN
   --DBMS_APPLICATION_INFO.set_client_info (OWA_UTIL.get_cgi_env ('HTTP_USER_AGENT'));
   DBMS_SESSION.set_identifier ('MicroStrategy Pandas Connector');
   DBMS_APPLICATION_INFO.set_module ('SIGLO', 'FUNC_RECUPERA_CATALOGO');

   FOR C1 IN (SELECT ARTICULO, NIVELVALOR
                --INTO v_ARTICULO
                FROM REP_PRO_SIGLO.CAT_ARTICULOCLASIF@SYG
               WHERE ARTICULO = p_GCDIRECTA)
   LOOP
      n_COUNTER := n_COUNTER + 1;

      SELECT COUNT (ID)
        INTO n_COUNT
        FROM REP_PRO_SIGLO.CAT_NIVELVALOR@SYG
       WHERE ID = C1.NIVELVALOR AND CLASIFICACION = 5;

      IF n_COUNT > 0
      THEN
         RETURN C1.NIVELVALOR;
      END IF;
   END LOOP;

   DBMS_APPLICATION_INFO.set_module ('SIGLO', NULL);
   RETURN n_COUNTER;
END;
/
